defmodule ExcyteWeb.Helpers.UI do
  use Phoenix.Component
  use Phoenix.HTML
  alias Phoenix.LiveView.JS
  alias ExcyteWeb.Router.Helpers, as: Routes

  def show_modal(js \\ %JS{}) do
    js
    |> JS.show(transition: "fade-in", to: "#modal")
    |> JS.show(transition: "fade-in-bottom", to: "#modal-content")
  end

  def hide_modal(js \\ %JS{}) do
    js
    |> JS.hide(transition: "fade-out", to: "#modal")
    |> JS.hide(transition: "fade-out-top", to: "#modal-content")
  end

  def toggle_menu(js \\ %JS{}, id) do
    js
    |> JS.toggle(
        to: "##{id}_menu",
        in: {"transition ease-out duration-200", "transform opacity-0 scale-90", "transform opacity-100 scale-100"},
        out: {"transition ease-in duration-75", "transform opacity-100 scale-100", "transform opacity-0 scale-90"})
    |> JS.add_class("rotate-180", to: "##{id}_arrow")
  end

  def hide_menu(js \\ %JS{}, id) do
    js
    |> JS.hide(to: "##{id}_menu")
    |> JS.remove_class("rotate-180", to: "##{id}_arrow")
  end

  def modal(assigns) do
    ~H"""
    <div id="modal" class="blackout" phx-remove={hide_modal()} phx-click={hide_modal()}>
      <div
        id="modal-content"
        class="ex-modal"
        phx-window-keydown={hide_modal()}
        phx-key="escape"
      >
        <div class="flex pb-4 border-b border-gray-300">
          <button class="pr-2 mr-3 border-r border-gray-400 flex justify-center items-center cursor-pointer" phx-click={hide_modal()}>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
          <div class="flex-1">
            <%= render_slot(@header) %>
          </div>
        </div>
        <%= render_slot(@inner_block) %>
      </div>
    </div>
    """
  end

  def accordian(assigns) do
    ~H"""
    <div x-data={"{ expanded: #{@expanded} }"} role="region" class="border-t border-gray-300">
      <button
        type="button"
        @click="expanded = !expanded"
        aria-expanded="expanded"
        class="pt-6 pb-4 w-full flex"
      >
        <h3 class="flex-1 text-left mb-0"><%= @title %></h3>
        <span x-show="!expanded" aria-hidden="true" class="ml-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </span>
        <span x-show="expanded" aria-hidden="true" class="ml-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
          </svg>
        </span>
      </button>

      <div x-show="expanded" class="pb-4">
        <%= render_slot(@inner_block) %>
      </div>
    </div>
    """
  end

  def form_header(assigns) do
    ~H"""
    <div class="protected-header fixed top-0 left-0 z-30 lg:z-40 w-full h-12 lg:h-18">
      <div class="bg-gray-100 backdrop-blur-sm max-w-screen-xl mx-auto h-12 lg:h-18 border-b border-wgray-300 bg-opacity-95 flex">
        <div class="flex-1 flex items-center lg:w-44 xl:w-48 lg:pl-6 cursor-pointer">
          <%= live_redirect to: Routes.live_path(@socket, @return_to),
            class: "pr-2 mr-3 border-r border-gray-400 flex justify-center items-center cursor-pointer",
            replace: false do %>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          <% end %>
          <%= live_redirect to: Routes.live_path(@socket, ExcyteWeb.Agent.Dashboard) do %>
            <svg class="w-18 lg:w-36 h-8 lg:h-14 mx-auto" viewBox="0 0 353 114" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
              <defs>
                <linearGradient x1="-21.0047568%" y1="136.393098%" x2="50%" y2="0%" id="linearGradient-1">
                  <stop stop-color="#E0AC02" offset="0%"></stop>
                  <stop stop-color="#F51AA4" offset="100%"></stop>
                </linearGradient>
                <circle id="path-2" cx="303.5" cy="94.5" r="15.5"></circle>
                <filter x="-3.2%" y="-3.2%" width="112.9%" height="112.9%" filterUnits="objectBoundingBox" id="filter-3">
                  <feOffset dx="2" dy="2" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>
                  <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 1 0" type="matrix" in="shadowOffsetOuter1"></feColorMatrix>
                </filter>
                <linearGradient x1="18.9480152%" y1="134.676418%" x2="50%" y2="66.7405255%" id="linearGradient-4">
                  <stop stop-color="#830520" offset="0%"></stop>
                  <stop stop-color="#F51AA4" offset="100%"></stop>
                </linearGradient>
                <path d="M326.218353,0 L329.380675,3.70372092 C331.525918,14.196289 338.95051,22.7329176 348.716951,26.3393846 L349,26.670578 L320.28257,79.9979044 C316.904559,75.0960701 311.327683,71.862988 304.999774,71.7645869 L326.218353,0 Z" id="path-5"></path>
                <filter x="-2.3%" y="-1.3%" width="109.1%" height="105.0%" filterUnits="objectBoundingBox" id="filter-6">
                  <feOffset dx="2" dy="2" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>
                  <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 1 0" type="matrix" in="shadowOffsetOuter1"></feColorMatrix>
                </filter>
                <filter x="0.0%" y="-0.0%" width="100.0%" height="100.0%" filterUnits="objectBoundingBox" id="filter-7">
                  <feGaussianBlur stdDeviation="0" in="SourceGraphic"></feGaussianBlur>
                </filter>
                <filter x="0.0%" y="-0.0%" width="100.0%" height="100.0%" filterUnits="objectBoundingBox" id="filter-8">
                  <feGaussianBlur stdDeviation="0" in="SourceGraphic"></feGaussianBlur>
                </filter>
              </defs>
              <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <g id="Desktop-HD" transform="translate(-27.000000, -20.000000)">
                  <g id="Group" transform="translate(27.000000, 20.000000)">
                    <g id="Oval">
                      <use fill="black" fill-opacity="1" filter="url(#filter-3)" xlink:href="#path-2"></use>
                      <use fill="url(#linearGradient-1)" fill-rule="evenodd" xlink:href="#path-2"></use>
                    </g>
                    <g id="Combined-Shape">
                      <use fill="black" fill-opacity="1" filter="url(#filter-6)" xlink:href="#path-5"></use>
                      <use fill="url(#linearGradient-4)" fill-rule="evenodd" xlink:href="#path-5"></use>
                    </g>
                    <g id="Group-2" transform="translate(0.000000, 13.000000)" fill-rule="nonzero">
                      <path d="M58.2202325,47.4206642 L21.5863221,47.4206642 C21.9155501,50.3481081 22.7086783,52.5287224 23.9657305,53.9625725 C25.7315896,56.023732 28.0361508,57.0542963 30.8794832,57.0542963 C32.6752721,57.0542963 34.381246,56.6062248 35.997456,55.7100685 C36.9851399,55.1425029 38.0476324,54.14181 39.1849653,52.7079599 L57.187659,54.3658408 C54.434116,59.1453411 51.1119564,62.5730875 47.2210805,64.6491829 C43.3302045,66.7252783 37.7483778,67.7633105 30.4754327,67.7633105 C24.1602418,67.7633105 19.191967,66.8746355 15.5704594,65.0972588 C11.9489518,63.3198822 8.94853287,60.4970322 6.56911259,56.6286241 C4.1896923,52.7602161 3,48.2122911 3,42.9847127 C3,35.5466154 5.38686694,29.5275226 10.1606724,24.9272536 C14.9344779,20.3269846 21.5264208,18.0268846 29.9366988,18.0268846 C36.7606966,18.0268846 42.1479824,19.0574488 46.098718,21.1186083 C50.0494536,23.1797678 53.0573549,26.1669107 55.1225121,30.0801265 C57.1876693,33.9933424 58.2202325,39.0864209 58.2202325,45.359515 L58.2202325,47.4206642 Z M39.6339103,38.683184 C39.2747525,35.1583025 38.3244952,32.6341668 36.7831097,31.1107011 C35.2417242,29.5872354 33.2140097,28.825514 30.6999052,28.825514 C27.7967132,28.825514 25.4771873,29.975564 23.741258,32.2756985 C22.6338549,33.7095486 21.9305148,35.8453557 21.6312166,38.683184 L39.6339103,38.683184 Z M53.9762059,19.1022667 L75.6602484,19.1022667 L83.2474186,32.3653137 L92.0467402,19.1022667 L112.20437,19.1022667 L95.9525615,41.7749077 L113.371627,66.6879283 L92.0467402,66.6879283 L83.2474186,51.3637322 L72.8767895,66.6879283 L53.078316,66.6879283 L70.4075922,41.7749077 L53.9762059,19.1022667 Z M218.116127,19.1022667 L218.116127,10.3647865 L236.433082,1 L236.433082,19.1022667 L246.48945,19.1022667 L246.48945,32.4101212 L236.433082,32.4101212 L236.433082,49.302583 C236.433082,51.3338706 236.627623,52.6780849 237.016711,53.3352662 C237.615307,54.35091 238.662835,54.8587243 240.159326,54.8587243 C241.506167,54.8587243 243.391717,54.4703957 245.816032,53.6937269 L247.162867,66.28466 C242.643465,67.2704319 238.423425,67.7633105 234.502619,67.7633105 C229.953287,67.7633105 226.601198,67.1808176 224.446251,66.0158144 C222.291305,64.8508113 220.697566,63.0809291 219.664987,60.7061149 C218.632409,58.3313007 218.116127,54.4853543 218.116127,49.1681603 L218.116127,32.4101212 L211.381952,32.4101212 L211.381,32.368 L197.411134,69.9588824 C195.256187,75.7540265 193.056379,79.6671837 190.811643,81.6984713 C187.639082,84.5661714 182.80549,86 176.31072,86 C173.676896,86 169.606502,85.6415429 164.099416,84.9246178 L162.662792,72.199262 C165.296616,73.0356745 168.229694,73.4538745 171.462114,73.4538745 C173.617061,73.4538745 175.360446,72.960996 176.692323,71.975224 C178.0242,70.9894521 179.154033,69.2270378 180.081858,66.6879283 L160.058912,19.1022667 L179.363546,19.1022667 L189.195441,50.7812335 L198.309024,19.1022667 L216.311717,19.1022667 L218.116127,19.1022667 Z M137.321345,18.0268846 C145.103097,18.0268846 151.036594,19.415906 155.122013,22.1939905 C159.207433,24.972075 162.07317,29.0345893 163.71931,34.3816552 L146.524717,36.6668424 C145.98598,34.6355548 145.005794,33.1046441 143.584127,32.0740643 C142.162461,31.0434846 140.254464,30.5282024 137.860079,30.5282024 C134.837168,30.5282024 132.390442,31.6110417 130.519828,33.7767528 C128.649215,35.9424638 127.713922,39.2208531 127.713922,43.612019 C127.713922,47.5252348 128.641733,50.497442 130.497381,52.5287296 C132.35303,54.5600172 134.71745,55.5756458 137.590712,55.5756458 C139.985097,55.5756458 141.997847,54.9632815 143.629022,53.7385345 C145.260197,52.5137876 146.479818,50.6318876 147.287923,48.0927781 L164.662094,50.0643121 C163.70434,53.6788091 162.133048,56.8078413 159.948172,59.4515024 C157.763295,62.0951635 154.972382,64.1488242 151.575348,65.6125461 C148.178314,67.0762681 143.861003,67.8081181 138.623285,67.8081181 C133.565147,67.8081181 129.352588,67.3376431 125.985484,66.396679 C122.61838,65.4557149 119.722714,63.932272 117.298399,61.8263047 C114.874084,59.7203374 112.973569,57.2484767 111.596798,54.4106484 C110.220026,51.5728201 109.531651,47.8090201 109.531651,43.1191355 C109.531651,38.2201477 110.369673,34.1426977 112.045743,30.8866632 C113.272865,28.496913 114.948909,26.353638 117.073926,24.4567739 C119.198943,22.5599097 121.383787,21.1484847 123.628523,20.2224565 C127.190171,18.7587346 131.754399,18.0268846 137.321345,18.0268846 Z M302,47.4206642 L265.36609,47.4206642 C265.695318,50.3481081 266.488446,52.5287224 267.745498,53.9625725 C269.511357,56.023732 271.815918,57.0542963 274.659251,57.0542963 C276.45504,57.0542963 278.161014,56.6062248 279.777224,55.7100685 C280.764907,55.1425029 281.8274,54.14181 282.964733,52.7079599 L300.967427,54.3658408 C298.213884,59.1453411 294.891724,62.5730875 291.000848,64.6491829 C287.109972,66.7252783 281.528145,67.7633105 274.2552,67.7633105 C267.940009,67.7633105 262.971735,66.8746355 259.350227,65.0972588 C255.728719,63.3198822 252.7283,60.4970322 250.34888,56.6286241 C247.96946,52.7602161 246.779768,48.2122911 246.779768,42.9847127 C246.779768,35.5466154 249.166634,29.5275226 253.94044,24.9272536 C258.714245,20.3269846 265.306188,18.0268846 273.716466,18.0268846 C280.540464,18.0268846 285.92775,19.0574488 289.878486,21.1186083 C293.829221,23.1797678 296.837122,26.1669107 298.90228,30.0801265 C300.967437,33.9933424 302,39.0864209 302,45.359515 L302,47.4206642 Z M284.413678,38.683184 C284.05452,35.1583025 283.104263,32.6341668 281.562877,31.1107011 C280.021492,29.5872354 277.993777,28.825514 275.479673,28.825514 C272.576481,28.825514 270.256955,29.975564 268.521026,32.2756985 C267.413622,33.7095486 266.710282,35.8453557 266.410984,38.683184 L284.413678,38.683184 Z" id="excyte" fill="#000000" filter="url(#filter-7)"></path>
                      <path d="M55.2202325,46.4206642 L18.5863221,46.4206642 C18.9155501,49.3481081 19.7086783,51.5287224 20.9657305,52.9625725 C22.7315896,55.023732 25.0361508,56.0542963 27.8794832,56.0542963 C29.6752721,56.0542963 31.381246,55.6062248 32.997456,54.7100685 C33.9851399,54.1425029 35.0476324,53.14181 36.1849653,51.7079599 L54.187659,53.3658408 C51.434116,58.1453411 48.1119564,61.5730875 44.2210805,63.6491829 C40.3302045,65.7252783 34.7483778,66.7633105 27.4754327,66.7633105 C21.1602418,66.7633105 16.191967,65.8746355 12.5704594,64.0972588 C8.94895181,62.3198822 5.94853287,59.4970322 3.56911259,55.6286241 C1.1896923,51.7602161 0,47.2122911 0,41.9847127 C0,34.5466154 2.38686694,28.5275226 7.16067242,23.9272536 C11.9344779,19.3269846 18.5264208,17.0268846 26.9366988,17.0268846 C33.7606966,17.0268846 39.1479824,18.0574488 43.098718,20.1186083 C47.0494536,22.1797678 50.0573549,25.1669107 52.1225121,29.0801265 C54.1876693,32.9933424 55.2202325,38.0864209 55.2202325,44.359515 L55.2202325,46.4206642 Z M36.6339103,37.683184 C36.2747525,34.1583025 35.3244952,31.6341668 33.7831097,30.1107011 C32.2417242,28.5872354 30.2140097,27.825514 27.6999052,27.825514 C24.7967132,27.825514 22.4771873,28.975564 20.741258,31.2756985 C19.6338549,32.7095486 18.9305148,34.8453557 18.6312166,37.683184 L36.6339103,37.683184 Z M50.9762059,18.1022667 L72.6602484,18.1022667 L80.2474186,31.3653137 L89.0467402,18.1022667 L109.20437,18.1022667 L92.9525615,40.7749077 L110.371627,65.6879283 L89.0467402,65.6879283 L80.2474186,50.3637322 L69.8767895,65.6879283 L50.078316,65.6879283 L67.4075922,40.7749077 L50.9762059,18.1022667 Z M215.116127,18.1022667 L215.116127,9.36478651 L233.433082,4.26325641e-14 L233.433082,18.1022667 L243.48945,18.1022667 L243.48945,31.4101212 L233.433082,31.4101212 L233.433082,48.302583 C233.433082,50.3338706 233.627623,51.6780849 234.016711,52.3352662 C234.615307,53.35091 235.662835,53.8587243 237.159326,53.8587243 C238.506167,53.8587243 240.391717,53.4703957 242.816032,52.6937269 L244.162867,65.28466 C239.643465,66.2704319 235.423425,66.7633105 231.502619,66.7633105 C226.953287,66.7633105 223.601198,66.1808176 221.446251,65.0158144 C219.291305,63.8508113 217.697566,62.0809291 216.664987,59.7061149 C215.632409,57.3313007 215.116127,53.4853543 215.116127,48.1681603 L215.116127,31.4101212 L208.381952,31.4101212 L208.381,31.368 L194.411134,68.9588824 C192.256187,74.7540265 190.056379,78.6671837 187.811643,80.6984713 C184.639082,83.5661714 179.80549,85 173.31072,85 C170.676896,85 166.606502,84.6415429 161.099416,83.9246178 L159.662792,71.199262 C162.296616,72.0356745 165.229694,72.4538745 168.462114,72.4538745 C170.617061,72.4538745 172.360446,71.960996 173.692323,70.975224 C175.0242,69.9894521 176.154033,68.2270378 177.081858,65.6879283 L157.058912,18.1022667 L176.363546,18.1022667 L186.195441,49.7812335 L195.309024,18.1022667 L213.311717,18.1022667 L215.116127,18.1022667 Z M134.321345,17.0268846 C142.103097,17.0268846 148.036594,18.415906 152.122013,21.1939905 C156.207433,23.972075 159.07317,28.0345893 160.71931,33.3816552 L143.524717,35.6668424 C142.98598,33.6355548 142.005794,32.1046441 140.584127,31.0740643 C139.162461,30.0434846 137.254464,29.5282024 134.860079,29.5282024 C131.837168,29.5282024 129.390442,30.6110417 127.519828,32.7767528 C125.649215,34.9424638 124.713922,38.2208531 124.713922,42.612019 C124.713922,46.5252348 125.641733,49.497442 127.497381,51.5287296 C129.35303,53.5600172 131.71745,54.5756458 134.590712,54.5756458 C136.985097,54.5756458 138.997847,53.9632815 140.629022,52.7385345 C142.260197,51.5137876 143.479818,49.6318876 144.287923,47.0927781 L161.662094,49.0643121 C160.70434,52.6788091 159.133048,55.8078413 156.948172,58.4515024 C154.763295,61.0951635 151.972382,63.1488242 148.575348,64.6125461 C145.178314,66.0762681 140.861003,66.8081181 135.623285,66.8081181 C130.565147,66.8081181 126.352588,66.3376431 122.985484,65.396679 C119.61838,64.4557149 116.722714,62.932272 114.298399,60.8263047 C111.874084,58.7203374 109.973569,56.2484767 108.596798,53.4106484 C107.220026,50.5728201 106.531651,46.8090201 106.531651,42.1191355 C106.531651,37.2201477 107.369673,33.1426977 109.045743,29.8866632 C110.272865,27.496913 111.948909,25.353638 114.073926,23.4567739 C116.198943,21.5599097 118.383787,20.1484847 120.628523,19.2224565 C124.190171,17.7587346 128.754399,17.0268846 134.321345,17.0268846 Z M299,46.4206642 L262.36609,46.4206642 C262.695318,49.3481081 263.488446,51.5287224 264.745498,52.9625725 C266.511357,55.023732 268.815918,56.0542963 271.659251,56.0542963 C273.45504,56.0542963 275.161014,55.6062248 276.777224,54.7100685 C277.764907,54.1425029 278.8274,53.14181 279.964733,51.7079599 L297.967427,53.3658408 C295.213884,58.1453411 291.891724,61.5730875 288.000848,63.6491829 C284.109972,65.7252783 278.528145,66.7633105 271.2552,66.7633105 C264.940009,66.7633105 259.971735,65.8746355 256.350227,64.0972588 C252.728719,62.3198822 249.7283,59.4970322 247.34888,55.6286241 C244.96946,51.7602161 243.779768,47.2122911 243.779768,41.9847127 C243.779768,34.5466154 246.166634,28.5275226 250.94044,23.9272536 C255.714245,19.3269846 262.306188,17.0268846 270.716466,17.0268846 C277.540464,17.0268846 282.92775,18.0574488 286.878486,20.1186083 C290.829221,22.1797678 293.837122,25.1669107 295.90228,29.0801265 C297.967437,32.9933424 299,38.0864209 299,44.359515 L299,46.4206642 Z M281.413678,37.683184 C281.05452,34.1583025 280.104263,31.6341668 278.562877,30.1107011 C277.021492,28.5872354 274.993777,27.825514 272.479673,27.825514 C269.576481,27.825514 267.256955,28.975564 265.521026,31.2756985 C264.413622,32.7095486 263.710282,34.8453557 263.410984,37.683184 L281.413678,37.683184 Z" id="excyte" fill="#05A1AD" filter="url(#filter-8)"></path>
                    </g>
                  </g>
                </g>
              </g>
            </svg>
          <% end %>
          <div class="ml-0">
            <%= render_slot(@title) %>
          </div>
        </div>
        <div class="form pr-6">
          <%= render_slot(@inner_block) %>
        </div>
      </div>
    </div>
    """
  end

  def large_toggle(assigns) do
    ~H"""
    <div
      role="checkbox"
      aria-checked={@enabled}
      phx-click="toggle-enabled"
      phx-value-id={@name}
      class="relative cursor-pointer">
      <% slider = if @enabled, do: "slider-selected ", else: "" %>
      <% dot = if @enabled, do: "dot-selected ", else: "" %>
      <div class={"#{slider}block bg-gray-400 w-14 h-8 rounded-full"}></div>
      <div class={"#{dot}absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"}></div>
    </div>
    """
  end

  def dropdown(assigns) do
    ~H"""
    <div
      x-data="{
          open: false,
          toggle() {
            this.open = this.open ? this.close() : true
          },
          close(focusAfter) {
              this.open = false

              focusAfter && focusAfter.focus()
          }
      }"
      x-on:keydown.escape.prevent.stop="close($refs.button)"
      x-on:focusin.window="! $refs.panel.contains($event.target) && close()"
      x-id="['dropdown-button']"
      class="relative"
    >
      <button
          x-ref="button"
          x-on:click="toggle()"
          aria-expanded="open"
          aria-controls="$id('dropdown-button')"
          type="button"
          class="border border-black py-2 focus:outline-none focus:ring-2 focus:ring-aqua-400 bg-white shadow rounded"
      >
        <div class="flex px-2">
          <div class="ml-2"><%= if @selected !== nil, do: extract_text(@selected), else: @label %></div>
          <div class="ml-2 -mt-0.5" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" x-bind:class="{'rotate-180': open}" class="ml-1 inline-block fill-current text-gray-500 w-6 h-6">
              <path fill-rule="evenodd" d="M15.3 10.3a1 1 0 011.4 1.4l-4 4a1 1 0 01-1.4 0l-4-4a1 1 0 011.4-1.4l3.3 3.29 3.3-3.3z"/>
            </svg>
          </div>
        </div>
      </button>
      <div
          x-ref="panel"
          x-show="open"
          x-transition.origin.top.left
          x-on:click.outside="close($refs.button)"
          x-bind:id="$id('dropdown-button')"
          style="display: none;"
          class="absolute left-0 mt-2 bg-white shadow rounded"
      >
        <div class="p-2">
          <%= for opt <- @options do %>
            <a
                href="#"
                phx-click={@callback}
                phx-value-option={extract_value(opt)}
                phx-value-attr={@attr}
                class="py-2 px-4 cursor-pointer block hover:bg-blue-100 rounded focus:outline-none focus:bg-blue-100"
              >
                <%= extract_text(opt) %>
              </a>
          <% end %>
        </div>
      </div>
    </div>
    """
  end

  defp extract_text(sel) do
    cond do
      is_map(sel) -> sel.text
      sel === "" -> nil
      true -> sel
    end
  end

  defp extract_value(sel) do
    cond do
      is_map(sel) -> sel.value
      sel === "" -> nil
      true -> sel
    end
  end
end
