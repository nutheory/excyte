<div class="h-screen w-full lg:w-80 xl:w-96 lg:flex lg:flex-col hidden">
  <div class="w-full h-18 lg:block hidden"></div>
  <div class="overflow-y-scroll lg:w-80 scrolling-touch fixed top-0 bottom-0 overflow-hidden pt-20 pr-6">
    <h2 class="">Builder</h2>
    <ul class="section-nav" phx-hook="InitSortable" id="sections" data-target-id="#builder" data-sections-id="sections">
      <%= for section <- @sections do %>
        <li
          class="section flex cursor-move" x-data="{actions: false}"
          @mouseover="actions = true"
          data-sortable-id="<%= section.temp_id %>"
          @mouseover.away="actions = false"
        >
          <div class="flex-1">
            <%= if section.component_name === "comparable" do %>
              <h4 class="title"><%= section.data["street_number"] %> <%= section.data["street_name"] %></h4>
              <h5 class="sub-title"><%= section.name %></h5>
            <% else %>
              <h5 class="title"><%= section.name %></h5>
            <% end %>
            <div class="flex opacity-0" :class="{'opacity-100': actions === true}">
              <button class="action" type="button" phx-click="edit-section" phx-value-section-pos="<%= section.position %>">edit</button>
            </div>
          </div>
          <div class="" phx-click="toggle-enabled" phx-value-id="<%= section.temp_id %>">
            <%= if section.enabled === true do %>
              <svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <% else %>
              <svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <% end %>
          </div>
        </li>
      <% end %>
    </ul>
    <button type="button" phx-click="new-section" class="action-button w-full my-6">Add a section</button>
  </div>
</div>





<div class="mb-4 p-2 rounded shadow bg-white">
  <div class="flex">
    <div class="mb-2 flex-1 flex">
      <div
        phx-click="toggle-upload-tab"
        phx-value-tab="upload"
        class="rounded text-base px-3 py-1 mr-4 <%= if @selected_tab === "upload", do: "font-bold bg-cyan-100", else: "cursor-pointer" %>">Upload new</div>
      <%= if length(@assets) > 0 do %>
        <div
          phx-click="toggle-upload-tab"
          phx-value-tab="existing"
          class="rounded text-base px-3 py-1 mr-4 <%= if @selected_tab === "existing", do: "font-bold bg-cyan-100", else: "cursor-pointer" %>">Use existing</div>
      <% end %>
    </div>
    <div class="link-button text-base m-1" phx-click="toggle-video">Cancel</div>
  </div>
  <div class="pt-2">
    <%= if @selected_tab === "upload" do %>
      <%= if @uploaded_asset do %>
        <div class="w-32 mr-3">
          <img src="<%= @uploaded_asset.thumb_url %>" alt="<%= @video_form.title %> thumbnail" />
        </div>
        <div class="flex-1">
          <h4 class="text-base"><%= @video_form.title %></h4>
          <p class="text-base"><%= @video_form.description %></p>
        </div>
        <div>
      <% else %>
        <div id="upload-video" phx-hook="MuxUploader" class="form mb-4" phx-update="ignore">
          <input type="file" id="file-field" name="file-field" class="action">
          <div id="adding-file" class="hidden rounded bg-cyan-100 p-2">
            <h4 class="font-normal text-base">Uploading... <span class="font-bold" id="filename"></span></h4>
            <label for="file-field">Progress:</label>
            <progress id="upload-progress" max="100" value="0"></progress>
            <p id="preparing" class="text-sm font-bold hidden">preparing...</p>
          </div>
        </div>
      <% end %>
      <%= f = form_for :video_form, "#", [phx_change: "validate-video-details", phx_submit: "update-new-video"] %>
        <div class="mb-4">
          <%= text_input f, :title, class: "text-field", placeholder: "Title", value: @video_form.title %>
        </div>
        <div class="mb-4">
          <%= textarea f, :description, class: "textarea", placeholder: "Description", value: @video_form.description %>
        </div>
        <div class="flex">
          <div class="flex-1"></div>
          <div class="">
            <%= submit "Add Video", class: "submit" %>
          </div>
        </div>
      </form>
    <% else %>
      <ul class="">
        <%= for asset <- @assets do %>
          <li class="flex rounded p-2 mb-2 hover:bg-cyan-100">
            <div
              phx-click="select-video"
              phx-value-uuid="<%= asset.uuid %>"
              class="w-32 mr-3 cursor-pointer">
              <img src="<%= asset.thumb_url %>" alt="<%= asset.title %> thumbnail" />
            </div>
            <div class="flex-1">
              <h4 class="text-base"><%= asset.title %></h4>
              <p class="text-base"><%= asset.description %></p>
            </div>
            <%= if asset.uploaded_by_id === @current_user.id do %>
              <div class="flex ">
                <button data-confirm="Are you sure?" phx-click="delete_video" phx-value-video-id="<%= asset.id %>">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                </button>
              </div>
            <% end %>
          </li>
        <% end %>
      </ul>
    <% end %>
  </div>
</div>



09:45:45.959 [error] GenServer #PID<0.5547.0> terminating
Jun 22 02:45:45 AM  ** (Ecto.ConstraintError) constraint error when attempting to insert struct:
Jun 22 02:45:45 AM  
Jun 22 02:45:45 AM      * sections_created_by_id_fkey (foreign_key_constraint)
Jun 22 02:45:45 AM  
Jun 22 02:45:45 AM  If you would like to stop this constraint violation from raising an
Jun 22 02:45:45 AM  exception and instead add it as an error to your changeset, please
Jun 22 02:45:45 AM  call `foreign_key_constraint/3` on your changeset with the constraint
Jun 22 02:45:45 AM  `:name` as an option.
Jun 22 02:45:45 AM  
Jun 22 02:45:45 AM  The changeset has not defined any constraint.
Jun 22 02:45:45 AM  
Jun 22 02:45:45 AM      (ecto 3.5.2) lib/ecto/repo/schema.ex:688: anonymous fn/4 in Ecto.Repo.Schema.constraints_to_errors/3
Jun 22 02:45:45 AM      (elixir 1.11.3) lib/enum.ex:1411: Enum."-map/2-lists^map/1-0-"/2
Jun 22 02:45:45 AM      (ecto 3.5.2) lib/ecto/repo/schema.ex:673: Ecto.Repo.Schema.constraints_to_errors/3
Jun 22 02:45:45 AM      (ecto 3.5.2) lib/ecto/repo/schema.ex:654: Ecto.Repo.Schema.apply/4
Jun 22 02:45:45 AM      (ecto 3.5.2) lib/ecto/repo/schema.ex:262: anonymous fn/15 in Ecto.Repo.Schema.do_insert/4
Jun 22 02:45:45 AM      (elixir 1.11.3) lib/enum.ex:1411: Enum."-map/2-lists^map/1-0-"/2
Jun 22 02:45:45 AM      (excyte 0.1.0) lib/excyte/insights.ex:84: Excyte.Insights.create_sections/3
Jun 22 02:45:45 AM      (ecto 3.5.2) lib/ecto/multi.ex:646: Ecto.Multi.apply_operation/5
Jun 22 02:45:45 AM  Last message: %Phoenix.Socket.Message{event: "event", join_ref: "123", payload: %{"event" => "publish", "type" => "form", "value" => "_csrf_token=DiIBeAg1KjUFKV5PbigPGSV9VDsaCklDBZW2XmsP5l29CNAJpEgqoOq6&publish%5Bname%5D=21982+Midcrest+Dr"}, ref: "136", topic: "lv:phx-ForeRzByKrVsewdh"}
Jun 22 02:45:47 AM  SPPPP: %{"max" => "300286", "min" => "271687"}
Jun 22 02:48:12 AM  09:48:12.215 [info] CONNECTED TO Phoenix.LiveView.Socket in 59Âµs
Jun 22 02:48:12 AM    Transport: :websocket
Jun 22 02:48:12 AM    Serializer: Phoenix.Socket.V2.JSONSerializer
Jun 22 02:48:12 AM    Parameters: %{"_csrf_token" => "DwocAToSAClgCT0kYzwrHCJUdx44F3EYCrJKjJYLPLQRNZeOwlDTMRIm", "_mounts" => "1", "_track_static" => %{"0" => "https://excyte.io/css/app-c4dddec60701072cf08314cbf19169d8.css?vsn=d", "1" => "https://excyte.io/js/app.js"}, "viewport" => %{"height" => "973", "width" => "1678"}, "vsn" => "2.0.0"}
Jun 22 02:48:12 AM  SPPPP: %{"max" => "300286", "min" => "271687"}
